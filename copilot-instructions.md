# Copilot Code Review Instructions

**Контекст проекта**

- Frontend: React + TypeScript.
- Состояние: Redux Toolkit (в т.ч. RTK Query).
- UI: Ant Design + кастомные компоненты.
- Архитектура: Feature-Sliced Design (FSD). Общие слои: `app/`, `pages/`, `widgets/`, `features/`, `entities/`, `shared/`.

## Основные цели ревью

1. **Безопасность и устойчивость**
   - Отсутствие `any`/`unknown` без явной причины.
   - Проверка данных из API: не полагаемся на “всегда есть поле”.
   - Исключить XSS (никакого `dangerouslySetInnerHTML`, если нет строгой необходимости).
   - Не хранить секреты в коде/конфиге.

2. **Архитектурная целостность (FSD)**
   - Импорты не нарушают границы слоёв:
     - `shared` можно везде.
     - `entities` нельзя импортировать из `features/widgets/pages/app`.
     - `feature` можно в `widgets/pages/app`.
     - `widgets` можно в `pages/app`.
     - `pages` — только в `app`.
   - Переиспользуем общие компоненты/утилиты вместо дублирования.

3. **TypeScript качество**
   - Нет “скрытых” `any` (например через неявные типы).
   - Корректная типизация RTK/RTK Query (аргументы, ответы, хуки).
   - Перенос типов API в `entities/*/model` и/или `shared/api`.
   - Юнит-типы/enum вместо строк-литералов, где это помогает.

4. **RTK / RTK Query**
   - Не вручную дергаем `fetch` рядом с RTK Query.
   - Нет лишних перерендеров из-за “широких” селекторов.
   - Мутации возвращают корректные теги, кеш инвалидируется предсказуемо.

5. **React-практики и производительность**
   - Нет лишних ререндеров: мемоизация пропов/коллбеков там, где есть тяжелые поддеревья.
   - Не создавать функции/объекты в JSX без нужды.
   - Списки: `key` стабильный и предсказуемый (не индекс, если есть id).
   - Эффекты (`useEffect`) — корректные зависимости, нет бесконечных циклов.
   - Для длинных списков/дорогих виджетов — подумать о виртуализации/ленивой загрузке.

6. **UI/UX и доступность**
   - Кликабельные элементы — кнопки/ссылки с ролями, а не дивы.
   - Управление клавиатурой и фокусом — где требуется.
   - Цвета/контраст — не ухудшаем читаемость.

7. **Тесты и надежность**
   - Базовые тесты на критические куски логики (парсинг, форматирование, редьюсеры, селекторы).
   - Для хуков/компонентов — хотя бы smoke/поведенческие тесты, если меняется поведение.

8. **Размер PR и структура**
   - Предпочтение маленьким PR (< ~300 строк diff).
   - Если PR большой — разбить по смыслу (рефактор отдельно от фич).
   - Названия коммитов осмысленные; миграции/правки линтера — отдельно.

## Что следует блокировать (попросить исправить)

- Явные/неявные `any`, неописанные типы API.
- Нарушение импорт-границ FSD.
- Хардкод секретов/URL окружений.
- Потенциальные бесконечные эффекты/рендер-петли.
- Неконтролируемые AntD-формы, если должны быть контролируемыми.
- Анти-паттерны в RTK Query (ручные фетчи, отсутствие тегов, бесконтрольный `refetch`).

## Неформальные, но полезные подсказки

- Предлагать выносить повторяющийся UI в `shared/ui`.
- Просить добавить memo/useMemo/useCallback, где профит очевиден.
- Предлагать объединять однотипные типы/утилиты.
- Для YouTube/iframe — исключить обходы ограничений провайдера; логика контроля проигрывания должна быть прозрачной.

## Формат комментариев Copilot

- Коротко: что и почему, затем — “как исправить”.
- Если есть быстрый патч — предложить diff-фрагмент.
- Если это рекомендация, пометить как `nit:`.
